# Requirements Document

## Introduction

This document outlines the requirements for integrating Quill.js rich text editor into the content management system to replace the current plain textarea for content editing. The editor will support rich text formatting and image insertion from both product images and local disk uploads.

## Glossary

- **Quill.js**: A modern WYSIWYG rich text editor library for web applications
- **Content Editor**: The rich text editing interface that replaces the current textarea in ContentForm
- **Image Toolbar**: The Quill toolbar button that triggers image insertion functionality
- **Product Image Picker**: A modal dialog that displays available product images for selection
- **File Upload Handler**: The mechanism that processes image files uploaded from the user's disk
- **Content Field**: The bilingual (English/Vietnamese) content input area in the ContentForm component
- **HTML Output**: The formatted HTML content generated by Quill.js editor
- **Editor Instance**: A single Quill.js editor object bound to a specific DOM element

## Requirements

### Requirement 1

**User Story:** As a content administrator, I want to use a rich text editor with formatting tools, so that I can create visually formatted content without writing HTML manually.

#### Acceptance Criteria

1. WHEN the content form loads THEN the Content Editor SHALL display a Quill.js editor with a toolbar containing formatting options
2. WHEN a user applies text formatting (bold, italic, underline, headers, lists) THEN the Content Editor SHALL update the text appearance immediately
3. WHEN a user switches between English and Vietnamese tabs THEN the Content Editor SHALL preserve the formatted content for each language independently
4. WHEN the form is submitted THEN the Content Editor SHALL output valid HTML that matches the formatted content
5. WHEN the preview mode is toggled THEN the system SHALL switch the Quill.js editor to read-only view mode displaying the formatted content

### Requirement 2

**User Story:** As a content administrator, I want to insert images from existing product images, so that I can reuse product imagery in content without re-uploading.

#### Acceptance Criteria

1. WHEN a user clicks the Image Toolbar button THEN the system SHALL display a dropdown with "From Products" and "Upload from Disk" options
2. WHEN a user selects "From Products" THEN the system SHALL open the Product Image Picker modal
3. WHEN the Product Image Picker displays THEN the system SHALL show all available product images in a grid layout
4. WHEN a user clicks on a product image in the picker THEN the system SHALL insert the selected image into the Content Editor at the cursor position
5. WHEN an image is inserted THEN the Content Editor SHALL display the image inline with the text content

### Requirement 3

**User Story:** As a content administrator, I want to upload images directly from my computer, so that I can add custom images that are not product photos.

#### Acceptance Criteria

1. WHEN a user selects "Upload from Disk" from the image dropdown THEN the system SHALL open a file selection dialog
2. WHEN a user selects an image file (JPEG, PNG, GIF, WebP) THEN the File Upload Handler SHALL validate the file type and size
3. WHEN the file validation passes THEN the File Upload Handler SHALL upload the image to the server
4. WHEN the upload completes successfully THEN the system SHALL insert the uploaded image into the Content Editor at the cursor position
5. IF the file validation fails THEN the system SHALL display an error message indicating the validation failure reason

### Requirement 4

**User Story:** As a content administrator, I want the editor to support both English and Vietnamese content, so that I can maintain bilingual content with proper formatting in both languages.

#### Acceptance Criteria

1. WHEN a user switches from English to Vietnamese tab THEN the system SHALL save the current Editor Instance state and load the Vietnamese content
2. WHEN a user switches from Vietnamese to English tab THEN the system SHALL save the current Editor Instance state and load the English content
3. WHEN content contains images in one language THEN the system SHALL preserve those images when switching between language tabs
4. WHEN the form is submitted THEN the system SHALL save both English and Vietnamese HTML Output independently
5. WHEN editing existing content THEN the Content Editor SHALL load and display the previously saved formatted content for each language

### Requirement 5

**User Story:** As a content administrator, I want the editor to integrate seamlessly with the existing ContentForm, so that I can use it without disrupting my current workflow.

#### Acceptance Criteria

1. WHEN the ContentForm component renders THEN the Content Editor SHALL replace the existing textarea while maintaining all other form fields
2. WHEN validation errors occur THEN the system SHALL display error messages below the Content Editor consistent with other form fields
3. WHEN the preview mode is activated THEN the system SHALL use Quill.js view mode to display the formatted content in a read-only editor
4. WHEN the form is cancelled THEN the system SHALL discard all editor changes without saving
5. WHEN the form is submitted successfully THEN the system SHALL clear the Content Editor state

### Requirement 6

**User Story:** As a developer, I want the Quill.js integration to be modular and maintainable, so that it follows the existing component architecture patterns.

#### Acceptance Criteria

1. WHEN implementing the editor THEN the system SHALL create a separate RichTextEditor component following the modular structure pattern
2. WHEN the RichTextEditor component is created THEN the system SHALL include custom hooks for editor initialization and state management
3. WHEN image insertion is implemented THEN the system SHALL create reusable utility functions for image handling
4. WHEN the component structure is defined THEN the system SHALL include TypeScript type definitions in a dedicated types file
5. WHEN the implementation is complete THEN the system SHALL export the RichTextEditor through an index file following the existing pattern

### Requirement 7

**User Story:** As a content administrator, I want uploaded images to be stored properly on the server, so that they remain accessible and don't break when content is viewed.

#### Acceptance Criteria

1. WHEN an image is uploaded from disk THEN the File Upload Handler SHALL store the image in the appropriate server directory
2. WHEN the image is stored THEN the system SHALL generate a unique filename to prevent conflicts
3. WHEN the upload completes THEN the system SHALL return a publicly accessible URL for the uploaded image
4. WHEN an image URL is inserted into content THEN the system SHALL use absolute or properly resolved relative URLs
5. WHEN content with images is saved THEN the system SHALL persist the image URLs in the database as part of the HTML Output

### Requirement 8

**User Story:** As a content administrator, I want to apply text color formatting, so that I can emphasize content and match brand colors.

#### Acceptance Criteria

1. WHEN the content form loads THEN the Content Editor SHALL display a color picker button in the toolbar
2. WHEN a user selects text and clicks the color button THEN the system SHALL display a color picker with predefined color options
3. WHEN a user selects a color from the picker THEN the Content Editor SHALL apply the selected color to the text
4. WHEN colored text is saved THEN the system SHALL persist the color formatting in the HTML Output
5. WHEN colored text is loaded THEN the Content Editor SHALL display the text with the correct color

### Requirement 9

**User Story:** As a content administrator, I want to resize images after inserting them, so that I can control the layout and visual hierarchy of my content.

#### Acceptance Criteria

1. WHEN an image is inserted into the Content Editor THEN the system SHALL set the image width to 300 pixels by default
2. WHEN an image is inserted into the Content Editor THEN the system SHALL display resize handles on the image
3. WHEN a user drags a resize handle THEN the Content Editor SHALL update the image dimensions in real-time
4. WHEN an image is resized THEN the system SHALL maintain the image aspect ratio by default
5. WHEN a resized image is saved THEN the system SHALL persist the image dimensions in the HTML Output
6. WHEN content with resized images is loaded THEN the Content Editor SHALL display images at their saved dimensions

### Requirement 10

**User Story:** As a website visitor, I want product images in content to be clickable links to the product page, so that I can easily navigate to purchase products featured in content.

#### Acceptance Criteria

1. WHEN a product image is inserted from the Product Image Picker THEN the system SHALL wrap the image in a link element pointing to the product page using the product slug
2. WHEN content is displayed in view mode THEN the system SHALL render product images as clickable links
3. WHEN a user clicks on a product image in view mode THEN the system SHALL navigate to the corresponding product detail page
4. WHEN a product image link is generated THEN the system SHALL use the correct locale-aware product URL format with the product slug (/${locale}/products/${slug})
5. WHEN content with product image links is saved THEN the system SHALL persist the link structure in the HTML Output
